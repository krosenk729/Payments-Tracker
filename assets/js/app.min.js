"use strict";(function(){function d(B){firebase.database().ref("payments").orderByChild("user").equalTo(B.id).on("child_changed",function(C){k(C)}),firebase.database().ref("payments").orderByChild("user").equalTo(B.id).on("child_added",function(C){k(C)}),firebase.database().ref("payments").orderByChild("user").equalTo(B.id).on("child_removed",function(C){m(C)}),$(".btn-add-new").on("click",e),$(".payments-items").on("change","input, select",f),$(".payments-items").on("click",".btn-remove-row",g),$("#hidetotal-true").on("change",function(){$("#should-hide-money").html(".show-money{visibility: hidden !important}")}),$("#hidetotal-false").on("change",function(){$("#should-hide-money").empty()}),$("#countdown-min").on("change",function(){clearInterval(A),z="minutes",A=setInterval(q,6e4)}),$("#countdown-min").on("change",function(){clearInterval(A),z="days",A=setInterval(q,8.64e7)}),A=setInterval(q,"minutes"==z?6e4:8.64e7)}function e(){var C={store:$("#new-store").val().trim(),desc:"",cost:$("#new-cost").val().trim(),freqUnit:$("#new-freqUnit").val().trim(),firstEvntDay:$("#new-firstEvntDay").val().trim(),firstEvntTime:$("#new-firstEvntTime").val().trim(),user:y.id};C.store&&C.cost&&C.firstEvntDay&&C.firstEvntTime&&j("payments",C,"push").then(function(){h()})}function f(){var B="payments/"+$(this).parentsUntil("tbody")[1].attributes["data-id"].value,C={};C[$(this).attr("name")]=$(this).val(),j(B,C,"update")}function g(){var B=$(this).parentsUntil("tbody")[1].attributes["data-id"].value;j("payments/"+B,{},"remove"),j("users/"+y.id+"/payments/"+B,{},"remove")}function h(){$("#new-store, #new-cost").val("0"),$("#new-firstEvntTime").val("12:00"),$("#new-firstEvntDay").val(moment(new Date).format("YYYY-MM-DD")),$("#new-freqUnit").val("year")}function j(){var B=0<arguments.length&&arguments[0]!==void 0?arguments[0]:"payments",C=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},D=2<arguments.length&&arguments[2]!==void 0?arguments[2]:"push";switch(D){case"update":firebase.database().ref(B).update(C);break;case"remove":firebase.database().ref(B).remove();break;case"push":default:firebase.database().ref(B).push(C);}}function k(B){var C=B.ge.path.n[1],D=$("tbody").find("tr[data-id=\""+C+"\"]"),E=B.val().store,F=B.val().desc,G=B.val().cost,H=B.val().freqUnit,I=B.val().firstEvntDay,J=B.val().firstEvntTime,K=s((r(I,J,x,H)+1)*G),L=s(Math.abs(r(I,J,"",z)))+" "+z,M="<tr data-id=\""+C+"\">\n\t<td>\n\t\t<label class=\"sr-only\">Description of Payment for Store</label>\n\t\t<input type=\"text\" name=\"desc\" value=\""+(F||E)+"\" required>\n\t\t<small class=\"desc-text\">Store: "+E+"</small>\n\t</td>\n\t<td>\n\t\t<label class=\"sr-only\">Cost of Recurring Payment</label>\n\t\t$<input type=\"number\" name=\"cost\" value=\""+G+"\">\n\t\t<select name=\"freqUnit\" value=\""+H+"\" required>\n\t\t\t<option value=\"hour\" "+("hour"===H?"selected":"")+">Hourly</option>\n\t\t\t<option value=\"day\" "+("day"===H?"selected":"")+">Daily</option>\n\t\t\t<option value=\"week\" "+("week"===H?"selected":"")+">Weekly</option>\n\t\t\t<option value=\"month\" "+("month"===H?"selected":"")+">Monthly</option>\n\t\t\t<option value=\"year\" "+("year"===H?"selected":"")+">Yearly</option>\n\t\t</select>\n\t\t<small class=\"cost-until show-money\">Total: $"+K+" by "+moment(x).format("YYYY")+"</small>\n\t</td>\n\t<td>\n\t\t<label class=\"sr-only\">Next Charge Date and Time</label>\n\t\t<input type=\"date\" name=\"firstEvntDay\" min=\""+moment(new Date).format("YYYY-MM-DD")+"\" max=\""+x+"\" value=\""+I+"\" required>\n\t\tat \n\t\t<input type=\"time\" step=\"60\" name=\"firstEvntTime\" value=\""+J+"\" required>\n\t\t<small class=\"count-until\">Next charge in "+L+"</small>\n\t</td>\n\t<td>\n\t\t<button class=\"btn btn-remove-row\">- Remove</button>\n\t</td>\n\t</tr>";0<D.length?D.replaceWith(M):$(".payments-items").append(M),l()}function l(){var B=0;firebase.database().ref("payments").orderByChild("user").equalTo(y.id).once("value",function(C){for(var D in C=C.val(),C)B+=+C[D].cost}),$(".payments-totals td:nth-child(2)").text(B)}function m(B){var C=B.ge.path.n[1],D=$("tbody").find("tr[data-id=\""+C+"\"]");D.remove(),l()}function q(){console.log("rechecked"),firebase.database().ref("payments").orderByChild("user").equalTo(y.id).once("value",function(B){for(var C in B=B.val(),B){var D=B[C].firstEvntDay,E=B[C].firstEvntTime,F=r(D,E,"","seconds");if(0<F){var G=moment(D+" "+E).add(1,B[C].freqUnit),I={};I.firstEvntDay=G.format("YYYY-MM-DD"),I.firstEvntTime=G.format("HH:mm"),j("payments/"+C,I,"update")}else $("[data-id=\""+C+"\"] .count-until").text("Next charge in "+s(Math.abs(r(D,E,"",z)))+" "+z)}}),console.log("rechecked done")}function r(B,C,D){var E=3<arguments.length&&arguments[3]!==void 0?arguments[3]:"days";return moment(D||new Date).diff(B+" "+C,E)}function s(B){var C="";do{var D=B%10;B=Math.trunc(B/10),C=D+C}while(0<B);return C.replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")}var w=new firebase.auth.GoogleAuthProvider,x="2020-01-01";firebase.initializeApp({apiKey:"AIzaSyD6FBfO14EljQNaKSud9lHWlsasUita6uY",authDomain:"recurring-payments-tracker.firebaseapp.com",databaseURL:"https://recurring-payments-tracker.firebaseio.com",projectId:"recurring-payments-tracker",storageBucket:"recurring-payments-tracker.appspot.com",messagingSenderId:"428623070633"});var y="",z="days",A={};$(".bt-user-login, .placeholder-for-list a").click(function(){firebase.auth().signInWithPopup(w).then(function(B){console.log("user sign in triggered",B)}).catch(function(B){console.log("error on sign in trigger",B)})}),$(".bt-user-logout").click(function(){clearInterval(A),firebase.auth().signOut().then(function(){h(),firebase.database().ref("payments").off("value"),firebase.database().ref("payments").off("child_added"),firebase.database().ref("payments").off("child_changed")})}),firebase.auth().onAuthStateChanged(function(B){if(B){y={name:B.displayName||B.email,id:B.uid,img:B.photoURL},firebase.database().ref("users").child(y.id).update({id:y.id}),function C(E){$(".bt-user-login, .placeholder-for-list").hide(),$(".user-nm").text(E.name),$(".user-img").attr("src",E.img),$(".user-loggedin, .payments-disp, .payments-form").show()}(y),d(y)}else{y=void 0,function D(){$(".bt-user-login, .placeholder-for-list").show(),$(".user-nm").text(""),$(".user-img").attr("src",""),$(".user-loggedin, .payments-disp, .payments-form").hide(),$(".payments-items tr").remove()}()}})})();